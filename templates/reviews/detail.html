{% extends 'base.html' %}
{% load django_bootstrap5 %}
{% load static %}
{% block body %} 
<div class="container">
여기는 리뷰 제목<br>
{{review.title}} <br>
여기는 평점 <br>
{{review.grade}} <br>
여기는 내용 <br>
{{review.content}} <br>

            <!--댓글-->
            <div class="card" style="width: 100%;">
                <div class="card-header">
                    <div class="col-md-12">
                        유저 인증 체크 해야함
                        <form id="comment-form" data-review-id="{{ review.pk }}">
                        {% csrf_token %}
                        {% bootstrap_form comment_form layout='floating'%}
                        {% bootstrap_button button_type="submit" id="detail_btn" content="댓글달기" %}
                        </form>
                      <hr>
                      <div id="comments">
                            {% for comment in comments %} 
                            <div class="d-flex justify-content-between flex-column">
                                    <div class="d-flex  justify-content-between">
                                        <h6 class="link mx-4">
                                            <a class="title_link" href="">
                                                여기는 댓글 아이디</a>
                                        </h6>
                                        <h6 class="link mx-4">
                                            여기는 댓글 생성시간
                                        </h6>
                                    </div>
                                    <p>
                                    <div class="d-flex  justify-content-between">
                                        <h6 class="mx-4 flex-fill">{{ comment.content }} </h6>
                                        <div class="commet-btn">
                                            <form action="{% url 'reviews:comment_delete' comment.review.pk comment.pk %}" method="POST">
                                                {% csrf_token %}
                                                <button class="float-end btn btn-dark  btn-sm ">DEL</button>
                                            </form>
                                        </div>
                                    </div>
                                </p>
                            </div>
                          <hr>    
                           {% endfor %}
                    </div>
                </div>
            </div>
        </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
    // 댓글!
    // (1) 댓글 폼
    const commentForm = document.querySelector('#comment-form')
    // (2) 제출하면, 함수 실행시킬래 
    // csrf 
    const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value
    commentForm.addEventListener('submit', function(event) {
      event.preventDefault();
      axios({
        method: 'post',
        url: `/reviews/${event.target.dataset.reviewId}/comments/`,
        headers: {'X-CSRFToken': csrftoken},
        data: new FormData(commentForm) // 폼에 있는 정보를 data로 넘겨줄 수 있도록 변환
      })
      .then(response => {
        console.log(response.data)
        // 댓글을 추가하는 로직
        const comments = document.querySelector('#comments')
        const p = document.createElement('p')
        p.innerText = `${response.data.userName} | ${response.data.content}`
        const hr = document.createElement('hr')
        comments.append(p, hr) 
        commentForm.reset()
      })
    })
  </script>

{% endblock %}

